<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maxima Fitness Tracker</title>
    <link rel="manifest" href="manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-color: #f4f7f6;
            --surface-color: #ffffff;
            --text-main: #1d1d1f;
            --text-muted: #86868b;
            --primary: #007aff;
            --secondary: #5856d6;
            --primary-fade: rgba(0, 122, 255, 0.1);
            --success: #34c759;
            --border: #e5e5ea;
            --radius: 20px;
            --nav-height: 70px;
        }
        [data-theme="dark"] {
            --bg-color: #000000;
            --surface-color: #1c1c1e;
            --text-main: #f5f5f7;
            --text-muted: #98989d;
            --border: #38383a;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-color); color: var(--text-main); transition: background 0.3s, color 0.3s; padding-bottom: var(--nav-height); }
        #app { max-width: 500px; margin: 0 auto; background: var(--bg-color); min-height: 100vh; position: relative; }
        .header { padding: 30px 20px 15px; position: sticky; top: 0; background: var(--bg-color); z-index: 10; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 12px; }
        .logo-box { background: var(--primary-fade); padding: 10px; border-radius: 12px; display: flex; align-items: center; justify-content: center; }
        .logo-box i { color: var(--primary); font-size: 22px; }
        .brand-text { font-size: 11px; color: var(--text-muted); font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; }
        .header h1 { font-size: 24px; }
        .view { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--surface-color); border-radius: var(--radius); padding: 20px; margin-bottom: 15px; border: 1px solid var(--border); }
        .ex-title { font-size: 18px; margin-bottom: 5px; display: flex; justify-content: space-between; font-weight: 600;}
        .ex-meta { font-size: 13px; color: var(--text-muted); margin-bottom: 15px; }
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-wrapper { flex: 1; display: flex; flex-direction: column; }
        .input-wrapper label { font-size: 12px; color: var(--text-muted); margin-bottom: 5px; font-weight: 600; text-transform: uppercase;}
        input[type="number"], select { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg-color); color: var(--text-main); font-size: 16px; outline: none; }
        .btn { width: 100%; padding: 14px; border-radius: 14px; border: none; font-size: 16px; font-weight: 600; cursor: pointer; }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .completed-badge { display: none; color: var(--success); font-size: 14px; }
        .completed .completed-badge { display: inline; }
        .completed .log-area { display: none; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; max-width: 500px; height: var(--nav-height); background: var(--surface-color); border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-muted); font-size: 11px; cursor: pointer; flex: 1;}
        .nav-item.active { color: var(--primary); }
        .chart-container { position: relative; height: 300px; width: 100%; }
        .pr-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid var(--border); }
        .setting-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--border); }
    </style>
</head>
<body>

<div id="app">
    <div class="header">
        <div class="logo-box"><i class="fa-solid fa-bolt"></i></div>
        <div>
            <div class="brand-text">Maxima Fitness</div>
            <h1 id="header-title">Workout</h1>
        </div>
    </div>

    <div id="view-workout" class="view active">
        <div style="margin-bottom: 15px;">
            <select id="split-select" onchange="app.changeSplit()">
                <option value="custom">Personalized Split</option>
                <option value="ppl">PPL (Push, Pull, Legs)</option>
                <option value="ul_custom">U/L (Upper, Lower)</option>
                <option value="fbeod">FBEOD (Full Body Every Other Day)</option>
            </select>
        </div>
        <div style="margin-bottom: 15px;">
            <select id="day-select" onchange="app.renderWorkout()"></select>
        </div>
        <div id="workout-list"></div>
    </div>

    <div id="view-progress" class="view">
        <div class="card">
            <h3>Progress Tracker</h3>
            <p class="ex-meta">Blue = Weight | Purple = Reps</p>
            <select id="chart-ex-select" onchange="app.renderChart()" style="margin: 15px 0;"></select>
            <div class="chart-container"><canvas id="progressChart"></canvas></div>
        </div>
    </div>

    <div id="view-milestones" class="view">
        <div class="card">
            <h3>Strength Milestones</h3>
            <div id="milestone-list" style="margin-top: 10px;"></div>
        </div>
    </div>

    <div id="view-settings" class="view">
        <div class="card">
            <div class="setting-row">
                <span>Dark Mode</span>
                <input type="checkbox" id="theme-toggle" onchange="app.toggleTheme()">
            </div>
            <div class="setting-row">
                <span>Weight Unit</span>
                <select id="unit-select" style="width:80px;" onchange="app.changeUnit()">
                    <option value="lbs">lbs</option>
                    <option value="kg">kg</option>
                </select>
            </div>
            <div class="setting-row" style="border:none; padding-top:20px;">
                <button class="btn btn-outline" onclick="app.clearData()">Reset All Data</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="app.switchTab('workout')"><i class="fa-solid fa-dumbbell"></i><span>Workout</span></div>
        <div class="nav-item" onclick="app.switchTab('progress')"><i class="fa-solid fa-chart-line"></i><span>Progress</span></div>
        <div class="nav-item" onclick="app.switchTab('milestones')"><i class="fa-solid fa-trophy"></i><span>Milestones</span></div>
        <div class="nav-item" onclick="app.switchTab('settings')"><i class="fa-solid fa-gear"></i><span>Settings</span></div>
    </div>
</div>

<script>
const routines = {
    custom: {
        "Day 1 (Chest + Shoulders + Triceps)": [
            { name: "Inclined Dumbbell Press", sets: "3", reps: "8" },
            { name: "Cable Flies", sets: "2", reps: "8" },
            { name: "Overhead DB Presses", sets: "2", reps: "8" },
            { name: "Cable Lateral Raises", sets: "2", reps: "8" },
            { name: "Reverse Cable Crossovers", sets: "2", reps: "8" },
            { name: "Tricep Pushdowns", sets: "2", reps: "8" },
            { name: "EZ Bar Skullcrushers", sets: "2", reps: "8" }
        ],
        "Day 2 (Back + Biceps)": [
            { name: "Dumbbell Rows", sets: "2", reps: "8" },
            { name: "Lat Pulldowns", sets: "2", reps: "8" },
            { name: "Dumbbell Shrugs", sets: "2", reps: "8" },
            { name: "Pullups", sets: "2", reps: "Failure" },
            { name: "Bayesian Curls", sets: "3", reps: "8" },
            { name: "Inclined Dumbbell Curls", sets: "3", reps: "8" },
            { name: "Hammer Curls", sets: "3", reps: "8" }
        ],
        "Day 3 (Legs + Abs)": [
            { name: "Leg Extensions", sets: "3", reps: "8" },
            { name: "Leg Curls", sets: "3", reps: "8" },
            { name: "Bulgarian Split Squats", sets: "2", reps: "8" },
            { name: "Calf Raises", sets: "3", reps: "8" },
            { name: "Dragon Flags", sets: "2", reps: "Failure" },
            { name: "Leg Raises", sets: "2", reps: "Failure" }
        ],
        "Day 4 (Chest + Shoulders + Triceps)": [
            { name: "Inclined Dumbbell Presse", sets: "2", reps: "8" },
            { name: "Cable Flies", sets: "2", reps: "8" },
            { name: "Overhead Dumbbell Press", sets: "2", reps: "8" },
            { name: "Cable Lateral Raises", sets: "2", reps: "8" },
            { name: "Reverse Cable Crossovers", sets: "2", reps: "8" },
            { name: "Overhead Tricep Extensions", sets: "2", reps: "8" },
            { name: "EZ Bar Skullcrushers", sets: "2", reps: "8" }
        ],
        "Day 5 (Back/Biceps)": [
            { name: "Dumbbell Rows", sets: "2", reps: "8" },
            { name: "Lat Pulldowns", sets: "2", reps: "8" },
            { name: "Dumbbell Shrugs", sets: "2", reps: "8" },
            { name: "Pullups", sets: "2", reps: "Failure" },
            { name: "EZ Bar Curls", sets: "2", reps: "8" },
            { name: "Inclined Dumbbell Curls", sets: "2", reps: "8" },
            { name: "Reverse Curls", sets: "2", reps: "8" }
        ]
    },
    ul_custom: {
        "Upper": [
            { name: "Inclined Dumbbell Press", sets: "3", reps: "6-10" },
            { name: "Overhead Dumbbell Press", sets: "2", reps: "6-10" },
            { name: "Cable Lateral Raises", sets: "2", reps: "6-10" },
            { name: "Dumbbell Rows", sets: "2", reps: "6-10" },
            { name: "Lat Pulldowns", sets: "2", reps: "6-10" },
            { name: "Bayesian Curls", sets: "2", reps: "6-10" },
            { name: "Reverse Curls", sets: "2", reps: "6-10" },
            { name: "Overhead Tricep Extensions", sets: "3", reps: "6-10" }
        ],
        "Lower": [
            { name: "Barbell Squats", sets: "2", reps: "6-10" },
            { name: "Romanian Deadlifts", sets: "2", reps: "6-10" },
            { name: "Leg Extensions", sets: "3", reps: "6-10" },
            { name: "Leg Curls", sets: "2", reps: "6-10" },
            { name: "Calf Raises", sets: "2", reps: "6-10" },
            { name: "Leg Raises", sets: "3", reps: "6-10" },
            { name: "Dragon Flags", sets: "2", reps: "Failure" }
        ]
    },
    fbeod: {
        "Workout A": [
            { name: "Inclined Dumbbell Press", sets: "2", reps: "6-10" },
            { name: "Cable Flies", sets: "2", reps: "6-10" },
            { name: "Overhead Dumbbell Press", sets: "2", reps: "6-10" },
            { name: "Dumbbell Lateral Raises", sets: "2", reps: "6-10" },
            { name: "Dumbbell Rows", sets: "2", reps: "6-10" },
            { name: "Lat Pulldowns", sets: "2", reps: "6-10" },
            { name: "Bayesian Curls", sets: "2", reps: "6-10" },
            { name: "EZ Bar Skullcrushers", sets: "2", reps: "6-10" },
            { name: "Leg Extensions", sets: "2", reps: "6-10" },
            { name: "Barbell Deadlifts", sets: "2", reps: "6-10" }
        ],
        "Workout B": [
            { name: "Inclined Dumbbell Press", sets: "2", reps: "6-10" },
            { name: "Cable Flies", sets: "2", reps: "6-10" },
            { name: "Overhead Dumbbell Press", sets: "3", reps: "6-10" },
            { name: "Reverse Cable Crossovers", sets: "2", reps: "6-10" },
            { name: "Dumbbell Rows", sets: "2", reps: "6-10" },
            { name: "Lat Pulldowns", sets: "3", reps: "6-10" },
            { name: "Inclined Dumbbell Curls", sets: "2", reps: "6-10" },
            { name: "Hammer Curls", sets: "2", reps: "6-10" },
            { name: "Leg Extensions", sets: "2", reps: "6-10" }
        ]
    },
    ppl: {
        "Push": [ 
            { name: "Bench Press", sets: "3", reps: "8-12" }, 
            { name: "Overhead Press", sets: "3", reps: "8-12" },
            { name: "Inclined Dumbbell Press", sets: "3", reps: "8-12" },
            { name: "Cable Lateral Raises", sets: "3", reps: "10-15" },
            { name: "Tricep Pushdowns", sets: "3", reps: "10-15" },
            { name: "Tricep Dips", sets: "3", reps: "Failure" } 
        ],
        "Pull": [ 
            { name: "Deadlifts", sets: "3", reps: "5-8" }, 
            { name: "Lat Pulldowns", sets: "3", reps: "8-12" },
            { name: "Seated Cable Rows", sets: "3", reps: "8-12" },
            { name: "Face Pulls", sets: "3", reps: "12-15" },
            { name: "Bicep Curls", sets: "3", reps: "12" },
            { name: "Hammer Curls", sets: "3", reps: "12" } 
        ],
        "Legs": [ 
            { name: "Barbell Squats", sets: "3", reps: "8-10" }, 
            { name: "Leg Press", sets: "3", reps: "10-12" },
            { name: "Romanian Deadlifts", sets: "3", reps: "8-10" },
            { name: "Leg Curls", sets: "3", reps: "10-12" },
            { name: "Leg Extensions", sets: "3", reps: "10-12" },
            { name: "Calf Raises", sets: "3", reps: "15" } 
        ]
    }
};

const app = {
    state: { theme: 'light', unit: 'lbs', logs: [], milestones: {}, currentSplit: 'custom' },
    chartInstance: null,

    init() {
        const saved = localStorage.getItem('maximaFitnessState');
        if (saved) {
            const parsed = JSON.parse(saved);
            if (parsed.prs) { parsed.milestones = parsed.prs; delete parsed.prs; }
            this.state = { ...this.state, ...parsed };
        }
        document.documentElement.setAttribute('data-theme', this.state.theme);
        document.getElementById('theme-toggle').checked = (this.state.theme === 'dark');
        document.getElementById('unit-select').value = this.state.unit;
        document.getElementById('split-select').value = this.state.currentSplit;
        this.populateDaySelect();
        this.renderWorkout();
    },

    saveState() { localStorage.setItem('maximaFitnessState', JSON.stringify(this.state)); },

    switchTab(tab) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(`view-${tab}`).classList.add('active');
        event.currentTarget.classList.add('active');
        const titles = { workout: 'Workout', progress: 'Progress', milestones: 'Strength Milestones', settings: 'Settings' };
        document.getElementById('header-title').innerText = titles[tab];
        if (tab === 'milestones') this.renderMilestones();
        if (tab === 'progress') this.setupChartData();
    },

    changeSplit() {
        this.state.currentSplit = document.getElementById('split-select').value;
        this.saveState();
        this.populateDaySelect();
        this.renderWorkout();
    },

    populateDaySelect() {
        const sel = document.getElementById('day-select');
        const days = Object.keys(routines[this.state.currentSplit]);
        sel.innerHTML = days.map(d => `<option value="${d}">${d}</option>`).join('');
    },

    renderWorkout() {
        const day = document.getElementById('day-select').value;
        const exercises = routines[this.state.currentSplit][day] || [];
        const container = document.getElementById('workout-list');
        container.innerHTML = exercises.map((ex, i) => {
            const record = this.state.milestones[ex.name];
            return `
            <div class="card" id="card-${i}">
                <div class="ex-title">${ex.name} <span class="completed-badge"><i class="fa-solid fa-circle-check"></i></span></div>
                <div class="ex-meta">${ex.sets} Sets x ${ex.reps} Reps | Best: ${record ? record.weight + this.state.unit + ' x ' + record.reps : 'None yet'}</div>
                <div class="log-area">
                    <div class="input-group">
                        <div class="input-wrapper"><label>Weight (${this.state.unit})</label><input type="number" id="w-${i}"></div>
                        <div class="input-wrapper"><label>Reps</label><input type="number" id="r-${i}"></div>
                    </div>
                    <button class="btn btn-primary" onclick="app.logSet(${i}, '${ex.name}')">Save & Complete</button>
                </div>
            </div>`;
        }).join('');
    },

    logSet(i, name) {
        const w = parseFloat(document.getElementById(`w-${i}`).value) || 0;
        const r = parseInt(document.getElementById(`r-${i}`).value) || 0;
        if (w === 0 && r === 0) return;
        const date = new Date().toISOString().split('T')[0];
        this.state.logs.push({ date, exercise: name, weight: w, reps: r, unit: this.state.unit });
        
        // Milestone logic: Is this the highest weight, or same weight but more reps?
        const best = this.state.milestones[name];
        if (!best || w > best.weight || (w === best.weight && r > best.reps)) {
            this.state.milestones[name] = { weight: w, reps: r, date, unit: this.state.unit };
        }
        this.saveState();
        document.getElementById(`card-${i}`).classList.add('completed');
    },

    renderMilestones() {
        const container = document.getElementById('milestone-list');
        const items = Object.entries(this.state.milestones);
        container.innerHTML = items.length ? items.map(([n, d]) => `<div class="pr-item"><strong>${n}</strong><span>${d.weight}${d.unit} x ${d.reps}</span></div>`).join('') : '<p>No milestones reached yet.</p>';
    },

    setupChartData() {
        const sel = document.getElementById('chart-ex-select');
        const exs = [...new Set(this.state.logs.map(l => l.exercise))].sort();
        sel.innerHTML = exs.map(e => `<option value="${e}">${e}</option>`).join('');
        if(exs.length) this.renderChart();
    },

    renderChart() {
        const name = document.getElementById('chart-ex-select').value;
        const data = this.state.logs.filter(l => l.exercise === name);
        const ctx = document.getElementById('progressChart').getContext('2d');
        if (this.chartInstance) this.chartInstance.destroy();
        
        this.chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map(d => d.date.slice(5)),
                datasets: [
                    { 
                        label: 'Weight', 
                        data: data.map(d => d.weight), 
                        borderColor: '#007aff', 
                        backgroundColor: 'rgba(0, 122, 255, 0.1)',
                        tension: 0.3,
                        yAxisID: 'y'
                    },
                    { 
                        label: 'Reps', 
                        data: data.map(d => d.reps), 
                        borderColor: '#5856d6', 
                        backgroundColor: 'transparent',
                        borderDash: [5, 5],
                        tension: 0.3,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: false,
                scales: {
                    y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Weight' } },
                    y1: { type: 'linear', display: true, position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'Reps' } }
                }
            }
        });
    },

    toggleTheme() {
        this.state.theme = document.getElementById('theme-toggle').checked ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', this.state.theme);
        this.saveState();
    },

    changeUnit() {
        const prevUnit = this.state.unit;
        const newUnit = document.getElementById('unit-select').value;
        if (prevUnit === newUnit) return;

        const factor = newUnit === 'kg' ? 0.453592 : 2.20462;
        
        // Precise conversion to prevent data drift
        this.state.logs.forEach(l => {
            l.weight = parseFloat((l.weight * factor).toFixed(1));
            l.unit = newUnit;
        });
        
        for (let m in this.state.milestones) {
            this.state.milestones[m].weight = parseFloat((this.state.milestones[m].weight * factor).toFixed(1));
            this.state.milestones[m].unit = newUnit;
        }

        this.state.unit = newUnit;
        this.saveState();
        this.renderWorkout();
    },

    clearData() {
        if(confirm("Reset all data?")) { this.state.logs = []; this.state.milestones = {}; this.saveState(); location.reload(); }
    }
};
document.addEventListener('DOMContentLoaded', () => app.init());
</script>
</body>
</html>
