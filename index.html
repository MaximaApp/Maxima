<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maxima - Fitness and Workout Tracker</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- CSS Variables & Theming --- */
        :root {
            --bg-color: #f4f7f6;
            --surface-color: #ffffff;
            --text-main: #1d1d1f;
            --text-muted: #86868b;
            --primary: #007aff;
            --primary-fade: rgba(0, 122, 255, 0.1);
            --success: #34c759;
            --border: #e5e5ea;
            --radius: 20px;
            --nav-height: 70px;
        }

        [data-theme="dark"] {
            --bg-color: #000000;
            --surface-color: #1c1c1e;
            --text-main: #f5f5f7;
            --text-muted: #98989d;
            --border: #38383a;
        }

        /* --- Base & Reset --- */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-color); color: var(--text-main); transition: background 0.3s, color 0.3s; padding-bottom: var(--nav-height); }
        
        /* App Container (Phone constraints on desktop) */
        #app { max-width: 500px; margin: 0 auto; background: var(--bg-color); min-height: 100vh; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.05); }
        
        /* --- Typography & Header --- */
        h1, h2, h3 { font-weight: 700; letter-spacing: -0.5px; }
        .header { padding: 30px 20px 15px; position: sticky; top: 0; background: var(--bg-color); z-index: 10; border-bottom: 1px solid var(--border); }
        .header h1 { font-size: 28px; }

        /* --- Views --- */
        .view { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Components --- */
        .card { background: var(--surface-color); border-radius: var(--radius); padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); border: 1px solid var(--border); }
        .ex-title { font-size: 18px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center;}
        .ex-meta { font-size: 13px; color: var(--text-muted); margin-bottom: 15px; }
        
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-wrapper { flex: 1; display: flex; flex-direction: column; }
        .input-wrapper label { font-size: 12px; color: var(--text-muted); margin-bottom: 5px; font-weight: 600; text-transform: uppercase;}
        input[type="number"], select { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg-color); color: var(--text-main); font-size: 16px; outline: none; transition: border 0.2s; }
        input[type="number"]:focus, select:focus { border-color: var(--primary); }
        
        .btn { width: 100%; padding: 14px; border-radius: 14px; border: none; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.1s, opacity 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-success { background: var(--success); color: #fff; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }

        .completed-badge { display: none; color: var(--success); font-size: 14px; }
        .completed .completed-badge { display: inline; }
        .completed .log-area { display: none; }

        /* --- Bottom Nav --- */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; max-width: 500px; height: var(--nav-height); background: var(--surface-color); border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 100; padding-bottom: env(safe-area-inset-bottom); box-shadow: 0 -4px 12px rgba(0,0,0,0.02);}
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-muted); text-decoration: none; font-size: 11px; font-weight: 500; flex: 1; height: 100%; cursor: pointer;}
        .nav-item i { font-size: 20px; margin-bottom: 4px; transition: transform 0.2s; }
        .nav-item.active { color: var(--primary); }
        .nav-item.active i { transform: translateY(-2px); }

        /* --- Utilities --- */
        .chart-container { position: relative; height: 250px; width: 100%; margin-top: 20px;}
        .pr-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid var(--border); }
        .pr-item:last-child { border-bottom: none; }
        .setting-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--border); }
        
        /* Select Dropdown styling */
        .split-selector { margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="app">
    <div class="header">
        <h1 id="header-title">Workout</h1>
    </div>

    <div id="view-workout" class="view active">
        <div class="split-selector">
            <select id="split-select" onchange="app.changeSplit()">
                <option value="custom">Custom Split (Chest/Back/Legs)</option>
                <option value="ppl">PPL (Push Pull Legs) - Demo</option>
                <option value="ul">Upper Lower - Demo</option>
            </select>
        </div>
        <div class="split-selector">
            <select id="day-select" onchange="app.renderWorkout()"></select>
        </div>
        <div id="workout-list"></div>
    </div>

    <div id="view-progress" class="view">
        <div class="card">
            <h3>Strength Progression</h3>
            <p class="ex-meta" style="margin-top:5px;">Select an exercise to view chart</p>
            <select id="chart-ex-select" onchange="app.renderChart()"></select>
            <div class="chart-container">
                <canvas id="progressChart"></canvas>
            </div>
        </div>
    </div>

    <div id="view-prs" class="view">
        <div class="card" id="pr-list">
            </div>
    </div>

    <div id="view-settings" class="view">
        <div class="card">
            <div class="setting-row">
                <span>Dark Mode</span>
                <input type="checkbox" id="theme-toggle" onchange="app.toggleTheme()">
            </div>
            <div class="setting-row">
                <span>Weight Unit</span>
                <select id="unit-select" style="width:100px; padding:5px;" onchange="app.changeUnit()">
                    <option value="lbs">lbs</option>
                    <option value="kg">kg</option>
                </select>
            </div>
            <div class="setting-row">
                <button class="btn btn-outline" onclick="app.clearData()">Reset All Data</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="app.switchTab('workout')">
            <i class="fa-solid fa-dumbbell"></i>
            <span>Workout</span>
        </div>
        <div class="nav-item" onclick="app.switchTab('progress')">
            <i class="fa-solid fa-chart-line"></i>
            <span>Progress</span>
        </div>
        <div class="nav-item" onclick="app.switchTab('prs')">
            <i class="fa-solid fa-trophy"></i>
            <span>PRs</span>
        </div>
        <div class="nav-item" onclick="app.switchTab('settings')">
            <i class="fa-solid fa-gear"></i>
            <span>Settings</span>
        </div>
    </div>
</div>

<script>
// --- DATA STRUCTURES ---
const routines = {
    custom: {
        "Tuesday": [
            { name: "Incline DB Press", sets: "3", reps: "8" },
            { name: "Cable Fly", sets: "3", reps: "8" },
            { name: "Overhead DB Press", sets: "2", reps: "8" },
            { name: "Lateral Raise", sets: "2", reps: "8" },
            { name: "Reverse Cable Crossover", sets: "2", reps: "8" },
            { name: "Tricep Pushdown", sets: "2", reps: "8" },
            { name: "EZ Skullcrusher", sets: "2", reps: "8" }
        ],
        "Wednesday": [
            { name: "DB Row", sets: "3", reps: "8" },
            { name: "Lat Pulldown", sets: "3", reps: "8" },
            { name: "DB Shrug", sets: "3", reps: "8" },
            { name: "Pullups", sets: "2", reps: "Failure" },
            { name: "Bayesian Curl", sets: "3", reps: "8" },
            { name: "Incline Curl", sets: "3", reps: "8" },
            { name: "Hammer Curl", sets: "3", reps: "8" }
        ],
        "Thursday": [
            { name: "Leg Extension", sets: "3", reps: "8" },
            { name: "Leg Curl", sets: "3", reps: "8" },
            { name: "Bulgarian Split Squat", sets: "2", reps: "8" },
            { name: "Calf Raise", sets: "3", reps: "8" },
            { name: "Dragon Flag", sets: "2", reps: "Failure" },
            { name: "Leg Raise", sets: "2", reps: "Failure" }
        ],
        "Saturday": [
            { name: "Incline DB Press", sets: "2", reps: "8" },
            { name: "Cable Fly", sets: "2", reps: "8" },
            { name: "Overhead Press", sets: "2", reps: "8" },
            { name: "Cable Lateral Raise", sets: "2", reps: "8" },
            { name: "Reverse Cable Crossover", sets: "2", reps: "8" },
            { name: "Overhead Extension", sets: "2", reps: "8" },
            { name: "Skullcrusher", sets: "2", reps: "8" }
        ],
        "Sunday": [
            { name: "Barbell Row", sets: "3", reps: "8" },
            { name: "Lat Pulldown", sets: "3", reps: "8" },
            { name: "DB Shrug", sets: "3", reps: "8" },
            { name: "Pullups", sets: "2", reps: "Failure" },
            { name: "EZ Curl", sets: "2", reps: "8" },
            { name: "Incline Curl", sets: "3", reps: "8" },
            { name: "Reverse Curl", sets: "3", reps: "8" }
        ]
    },
    ppl: {
        "Push": [ { name: "Bench Press", sets: "3", reps: "8-12" }, { name: "Tricep Dips", sets: "3", reps: "10" } ],
        "Pull": [ { name: "Deadlift", sets: "3", reps: "5" }, { name: "Bicep Curls", sets: "3", reps: "12" } ],
        "Legs": [ { name: "Squat", sets: "3", reps: "8" }, { name: "Leg Press", sets: "3", reps: "10" } ]
    },
    ul: {
        "Upper": [ { name: "Bench Press", sets: "3", reps: "8" }, { name: "Barbell Row", sets: "3", reps: "8" } ],
        "Lower": [ { name: "Squat", sets: "3", reps: "8" }, { name: "RDL", sets: "3", reps: "8" } ]
    }
};

// --- APP LOGIC ---
const app = {
    state: {
        theme: 'light',
        unit: 'lbs',
        logs: [], // { date, exercise, weight, reps }
        prs: {},  // { "Bench Press": { weight, reps, date } }
        currentSplit: 'custom'
    },
    chartInstance: null,

    init() {
        // Load State
        const savedState = localStorage.getItem('workoutAppState');
        if (savedState) this.state = { ...this.state, ...JSON.parse(savedState) };
        
        // Apply Settings
        document.documentElement.setAttribute('data-theme', this.state.theme);
        document.getElementById('theme-toggle').checked = (this.state.theme === 'dark');
        document.getElementById('unit-select').value = this.state.unit;
        document.getElementById('split-select').value = this.state.currentSplit;

        this.populateDaySelect();
        this.renderWorkout();
    },

    saveState() {
        localStorage.setItem('workoutAppState', JSON.stringify(this.state));
    },

    // --- NAVIGATION ---
    switchTab(tab) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        
        document.getElementById(`view-${tab}`).classList.add('active');
        event.currentTarget.classList.add('active');

        const titles = { workout: 'Workout', progress: 'Progress', prs: 'Personal Records', settings: 'Settings' };
        document.getElementById('header-title').innerText = titles[tab];

        if (tab === 'prs') this.renderPRs();
        if (tab === 'progress') this.setupChartData();
    },

    // --- WORKOUT LOGIC ---
    changeSplit() {
        this.state.currentSplit = document.getElementById('split-select').value;
        this.saveState();
        this.populateDaySelect();
        this.renderWorkout();
    },

    populateDaySelect() {
        const daySelect = document.getElementById('day-select');
        const days = Object.keys(routines[this.state.currentSplit]);
        daySelect.innerHTML = days.map(day => `<option value="${day}">${day}</option>`).join('');
        
        // Try to auto-select current day if in custom split
        const today = new Date().toLocaleDateString('en-US', { weekday: 'long' });
        if (days.includes(today)) daySelect.value = today;
    },

    renderWorkout() {
        const day = document.getElementById('day-select').value;
        const exercises = routines[this.state.currentSplit][day] || [];
        const container = document.getElementById('workout-list');
        const unit = this.state.unit;
        
        container.innerHTML = exercises.map((ex, index) => {
            const pr = this.state.prs[ex.name];
            const prText = pr ? `PR: ${pr.weight}${unit} x ${pr.reps}` : `No PR set`;
            
            return `
            <div class="card" id="card-${index}">
                <div class="ex-title">
                    ${ex.name} 
                    <span class="completed-badge"><i class="fa-solid fa-circle-check"></i> Done</span>
                </div>
                <div class="ex-meta">${ex.sets} Sets x ${ex.reps} Reps | ${prText}</div>
                
                <div class="log-area">
                    <div class="input-group">
                        <div class="input-wrapper">
                            <label>Weight (${unit})</label>
                            <input type="number" id="weight-${index}" placeholder="0">
                        </div>
                        <div class="input-wrapper">
                            <label>Reps</label>
                            <input type="number" id="reps-${index}" placeholder="${ex.reps.replace(/[^0-9]/g, '') || 0}">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="app.logSet(${index}, '${ex.name}')">Save & Complete</button>
                </div>
            </div>`;
        }).join('');
    },

    logSet(index, exName) {
        const weightInput = document.getElementById(`weight-${index}`);
        const repsInput = document.getElementById(`reps-${index}`);
        const weight = parseFloat(weightInput.value) || 0;
        const reps = parseInt(repsInput.value) || 0;
        
        if (weight === 0 && reps === 0) return alert('Please enter weight or reps.');

        const date = new Date().toISOString().split('T')[0];
        
        // Save Log
        this.state.logs.push({ date, exercise: exName, weight, reps });
        
        // Check/Set PR
        const currentPR = this.state.prs[exName];
        let newPR = false;
        if (!currentPR || weight > currentPR.weight || (weight === currentPR.weight && reps > currentPR.reps)) {
            this.state.prs[exName] = { weight, reps, date };
            newPR = true;
        }

        this.saveState();

        // UI Update
        document.getElementById(`card-${index}`).classList.add('completed');
        if (newPR) alert(`ðŸŽ‰ New Personal Record for ${exName}: ${weight}${this.state.unit} x ${reps}!`);
    },

    // --- PRs & PROGRESS ---
    renderPRs() {
        const container = document.getElementById('pr-list');
        const prs = Object.entries(this.state.prs);
        
        if (prs.length === 0) {
            container.innerHTML = `<p class="ex-meta">No personal records logged yet.</p>`;
            return;
        }

        container.innerHTML = prs.sort((a,b) => a[0].localeCompare(b[0])).map(([name, data]) => `
            <div class="pr-item">
                <strong style="flex:1">${name}</strong>
                <span style="color:var(--primary); font-weight:600;">${data.weight} ${this.state.unit} Ã— ${data.reps}</span>
            </div>
        `).join('');
    },

    setupChartData() {
        const select = document.getElementById('chart-ex-select');
        // Get unique exercises from logs
        const exercises = [...new Set(this.state.logs.map(log => log.exercise))].sort();
        
        if (exercises.length === 0) {
            select.innerHTML = '<option>No data logged yet</option>';
            return;
        }
        
        select.innerHTML = exercises.map(ex => `<option value="${ex}">${ex}</option>`).join('');
        this.renderChart();
    },

    renderChart() {
        const selectedEx = document.getElementById('chart-ex-select').value;
        const exLogs = this.state.logs.filter(log => log.exercise === selectedEx).sort((a,b) => new Date(a.date) - new Date(b.date));
        
        const labels = exLogs.map(log => log.date.slice(5)); // Just MM-DD
        const data = exLogs.map(log => log.weight);

        const ctx = document.getElementById('progressChart').getContext('2d');
        if (this.chartInstance) this.chartInstance.destroy();

        this.chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: `Weight (${this.state.unit})`,
                    data: data,
                    borderColor: '#007aff',
                    backgroundColor: 'rgba(0, 122, 255, 0.1)',
                    borderWidth: 3,
                    tension: 0.3,
                    fill: true,
                    pointBackgroundColor: '#ffffff',
                    pointBorderColor: '#007aff',
                    pointRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: false, grid: { color: 'rgba(0,0,0,0.05)' } },
                    x: { grid: { display: false } }
                }
            }
        });
    },

    // --- SETTINGS ---
    toggleTheme() {
        this.state.theme = document.getElementById('theme-toggle').checked ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', this.state.theme);
        this.saveState();
        if(this.chartInstance) this.chartInstance.update();
    },

    changeUnit() {
        const newUnit = document.getElementById('unit-select').value;
        if (this.state.unit !== newUnit) {
            // Simple conversion logic
            const factor = newUnit === 'kg' ? 0.453592 : 2.20462;
            this.state.logs.forEach(log => log.weight = Math.round(log.weight * factor));
            for (let ex in this.state.prs) {
                this.state.prs[ex].weight = Math.round(this.state.prs[ex].weight * factor);
            }
            this.state.unit = newUnit;
            this.saveState();
            this.renderWorkout();
        }
    },

    clearData() {
        if(confirm("Are you sure you want to delete all logs and PRs? This cannot be undone.")) {
            this.state.logs = [];
            this.state.prs = {};
            this.saveState();
            alert("Data cleared.");
            location.reload();
        }
    }
};

// Initialize app on load
document.addEventListener('DOMContentLoaded', () => app.init());

</script>
</body>
</html>
